<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE-edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Página de profesor</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<style>
    .nav-tabs .nav-link {
        padding: 0.5rem 1rem; 
        font-size: 0.875rem; 
    }
    .card {
        margin: 0.5rem 0; 
    }
    .lista {
        max-width: 50%;
    }
    .botones {
        margin-top: 20px; /* Espacio entre la lista y los botones */
    }
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
<script>
$(document).ready(function() {
    $.ajax({
        url: '/NotasOnline/api/profesor',
        dataType: 'json',
        success: function(data) {
            $('#usuario').text(data.nombre);
            $('#apellidos').text(data.apellidos);
            $('#dni').text(data.dni);

            for (var i = 0; i < data.asignaturas.length; i++) {
                (function(i) { // Usar una IIFE para capturar correctamente el valor de i
                    var tabId = 'asignatura' + (i + 1);
                    var activeClass = i === 0 ? 'active' : '';
                    var showClass = i === 0 ? 'show' : '';

                    // Crear pestaña
                    $('#myTab').append(`
                        <li class="nav-item" role="presentation">
                            <a class="nav-link ${activeClass}" id="${tabId}-tab" data-bs-toggle="tab" href="#${tabId}" role="tab" aria-controls="${tabId}" aria-selected="${i === 0}">
                                ${data.asignaturas[i].acronimo}
                            </a>
                        </li>
                    `);

                    // Crear contenido de la pestaña inicial
                    $('#myTabContent').append(`
                        <div class="tab-pane fade ${showClass} ${activeClass}" id="${tabId}" role="tabpanel" aria-labelledby="${tabId}-tab">
                            <div class="card mt-3" style="width: 80rem;">
                                <div class="card-body">
                                    <h5 class="card-title">${data.asignaturas[i].nombre}</h5>
                                    <div id="alumnos-${tabId}"></div>
                                </div>
                            </div>
                        </div>
                    `);

                    // Realizar AJAX para obtener los alumnos
                    $.ajax({
                        url: `/NotasOnline/api/notas?asignatura=${data.asignaturas[i].acronimo}`,
                        dataType: 'json',
                        success: function(notasData) {
                            var alumnosHtml = '';
                            for (var j = 0; j < notasData.length; j++) {
                                alumnosHtml += `<a href="#" class="alumno-link" data-alumno-id="${notasData[j].alumno}">${notasData[j].nombre} ${notasData[j].apellidos}</a><br>`;
                            }
                            $(`#alumnos-${tabId}`).html(alumnosHtml);
                        },
                        error: function(xhr, status, error) {
                            console.error('Error al obtener los alumnos:', error);
                        }
                    });
                })(i); // Llamada a la IIFE
            }
        },
        error: function(xhr, status, error) {
            console.error('Error al obtener los datos del profesor:', error);
        }
    });
});
</script>
</head>
<body>

<h1 class="p-3 mb-2 bg-info-subtle text-info-emphasis">Notas Online</h1></br>

<div class="container tamaño">
    <img src="/NotasOnline/imgs/h/10.png" class="img-thumbnail rounded mx-auto d-block" alt="foto hombre" /></br>
    <div class="fs-2 text-center">
        <p class="fw-bold">Bienvenid@ <span id="usuario"> </span> <span id="apellidos"></span></p>
        <p class="fw-bold" id="dni"></p>
    </div>

    <div class="container mt-5">
        <ul class="nav nav-tabs" id="myTab" role="tablist"></ul>
        <div class="tab-content" id="myTabContent"></div>
    </div>
    <div class="d-flex justify-content-between align-items-start botones">   
        <div class="card lista">
            <div class="card-body">
                <ol>
                    <li>Brosel Saura, Jaime</li>
                    <li>Galvañ Rivera, David</li>
                    <li>Lorente Núñez, Vicente Rafael</li>
                    <li>Navarro Martínez, Javier</li>
                    <li>Soler Figueras, Norberto</li>
                    <li>Torres Y Ubeda, Alejandro</li>
                </ol>
            </div>
        </div>
        <div class="d-flex justify-content-end mt-3">
        <a href="/NotasOnline/logout" class="btn btn-secondary btn-lg">Cerrar sesión</a>
        </div>
    </div>
</div>
</body>
</html>